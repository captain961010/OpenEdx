"use strict";(globalThis.webpackChunk_edx_frontend_app_course_authoring=globalThis.webpackChunk_edx_frontend_app_course_authoring||[]).push([[681],{3681:(e,r,t)=>{t.r(r),t.d(r,{default:()=>H});var o=t(89526),a=t(64403),i=t.n(a),n=t(22352),s=t(36105),c=t.n(s),l=t(2652),d=t.n(l),g=t(76079),p=t(84790),u=t(54877),m=t(56549),h=t(48387),f=t(95765),b=t(23768),x=t(40113),v=t(4138),k=t(34926),E=t(41857),P=t(77062),j=t(50322),Z=t(94765),M=t(72079),_=t(87037),y=t(26672),O=t(56132),w=t(88146),S=t(58408),T=t(94488);const C=(0,t(93477).vU)({"authoring.proctoring.no":{id:"authoring.proctoring.no",defaultMessage:"No",description:'"No" option for yes/no radio button set'},"authoring.proctoring.yes":{id:"authoring.proctoring.yes",defaultMessage:"Yes",description:'"Yes" option for proctored exam settings'},"authoring.proctoring.support.text":{id:"authoring.proctoring.support.text",defaultMessage:"Support Page",description:"Text linking to the support page."},"authoring.proctoring.enableproctoredexams.label":{id:"authoring.proctoring.enableproctoredexams.label",defaultMessage:"Proctored exams",description:"Label for checkbox to enable proctored exams."},"authoring.proctoring.enableproctoredexams.help":{id:"authoring.proctoring.enableproctoredexams.help",defaultMessage:"Enable and configure proctored exams in your course.",description:"Help text for checkbox to enable proctored exams."},"authoring.proctoring.enabled":{id:"authoring.proctoring.enabled",defaultMessage:"Enabled",description:"Text describing that the feature is enabled."},"authoring.proctoring.learn.more":{id:"authoring.proctoring.learn.more",defaultMessage:"Learn more about proctoring",description:"Link to learn more about the proctoring feature."},"authoring.proctoring.provider.label":{id:"authoring.proctoring.provider.label",defaultMessage:"Proctoring provider",description:"Label for proctoring provider dropdown selection."},"authoring.proctoring.provider.help":{id:"authoring.proctoring.provider.help",defaultMessage:"Select the proctoring provider you want to use for this course run.",description:"Help text for selecting a proctoring provider."},"authoring.proctoring.provider.help.aftercoursestart":{id:"authoring.proctoring.provider.help.aftercoursestart",defaultMessage:"Proctoring provider cannot be modified after course start date.",description:"Help text notifying the user that the provider cannot be changed for a course that has already begun."},"authoring.proctoring.escalationemail.label":{id:"authoring.proctoring.escalationemail.label",defaultMessage:"Proctortrack escalation email",description:"Label for escalation email text field"},"authoring.proctoring.escalationemail.help":{id:"authoring.proctoring.escalationemail.help",defaultMessage:"Provide an email address to be contacted by the support team for escalations (e.g. appeals, delayed reviews).",description:"Help text explaining escalation email field."},"authoring.proctoring.escalationemail.error.blank":{id:"authoring.proctoring.escalationemail.error.blank",defaultMessage:"The Proctortrack Escalation Email field cannot be empty if proctortrack is the selected provider.",description:"Error message for missing required email field."},"authoring.proctoring.escalationemail.error.invalid":{id:"authoring.proctoring.escalationemail.error.invalid",defaultMessage:"The Proctortrack Escalation Email field is in the wrong format and is not valid.",description:"Error message for a invalid email format."},"authoring.proctoring.allowoptout.label":{id:"authoring.proctoring.allowoptout.label",defaultMessage:"Allow learners to opt out of proctoring on proctored exams",description:"Label for radio selection allowing proctored exam opt out"},"authoring.proctoring.createzendesk.label":{id:"authoring.proctoring.createzendesk.label",defaultMessage:"Create Zendesk tickets for suspicious attempts",description:"Label for Zendesk ticket creation radio select."},"authoring.proctoring.error.single":{id:"authoring.proctoring.error.single",defaultMessage:"There is 1 error in this form.",description:"Error alert for one and only one error in the form."},"authoring.proctoring.error.multiple":{id:"authoring.proctoring.escalationemail.error.multiple",defaultMessage:"There are {numOfErrors} errors in this form.",description:"Error alert for multiple errors in the form."},"authoring.proctoring.save":{id:"authoring.proctoring.save",defaultMessage:"Save",description:"Button to save proctoring settings."},"authoring.proctoring.saving":{id:"authoring.proctoring.saving",defaultMessage:"Saving...",description:"Proctoring settings are in the process of saving."},"authoring.proctoring.cancel":{id:"authoring.proctoring.cancel",defaultMessage:"Cancel",description:"Button to cancel edits to proctoring settings."},"authoring.proctoring.studio.link.text":{id:"authoring.proctoring.studio.link.text",defaultMessage:"Go back to your course in Studio",description:"Link to go back to the course Studio page."}});var L=t(67557);function R(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function N(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?R(Object(t),!0).forEach((function(r){I(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function I(e,r,t){return(r=function(e){var r=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof r?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const D=e=>{let{intl:r,onClose:t}=e;const[a,s]=(0,o.useState)({enableProctoredExams:!1,proctoringProvider:!1,proctortrackEscalationEmail:"",allowOptingOut:!1,createZendeskTickets:!1}),[l,d]=(0,o.useState)(!0),[m,h]=(0,o.useState)(!1),[R,I]=(0,o.useState)(!1),[D,H]=(0,o.useState)(!1),[F,Y]=(0,o.useState)(!1),[A,z]=(0,o.useState)([]),[B,U]=(0,o.useState)([]),[V,G]=(0,o.useState)(""),[q,W]=(0,o.useState)(!1),[J,K]=(0,o.useState)(!1),[Q,X]=(0,o.useState)(!1),[$,ee]=(0,o.useState)(!1),re=(0,p.IC)().administrator,[te,oe]=(0,o.useState)({isValid:!0,errors:{}}),ae=(0,S.dD)(),ie=ae?"dark":"default",{courseId:ne}=(0,o.useContext)(T.e),se=(0,O.tT)("courseApps","proctoring"),ce=o.createRef(),le=o.createRef(),de=(0,o.useRef)(null),ge=Q?"pending":"default",pe=e=>{const{target:r}=e,t="checkbox"===r.type?r.checked:r.value,{name:o}=r;if(["allowOptingOut","createZendeskTickets"].includes(o))s(N(N({},a),{},{[o]:"true"===t}));else if("proctoringProvider"===o){const e=N(N({},a),{},{proctoringProvider:t});"proctortrack"===t?(s(N(N({},e),{},{createZendeskTickets:!1})),ee(!0)):(s("software_secure"===t?N(N({},e),{},{createZendeskTickets:!0}):e),ee(!1))}else s(N(N({},a),{},{[o]:t}))};function ue(e){return B.some((r=>r.name===e))}const me=()=>{de&&de.current&&de.current.focus()};function he(){const e=c()(c()()).format("YYYY-MM-DD[T]hh:mm:ss[Z]");return!re&&e>V}function fe(e){let r=!1;return he()&&(r=e!==a.proctoringProvider),r}function be(e){return B.find((r=>r.name===e))?.verbose_name||e}const xe=se.documentationLinks?.learnMoreConfiguration&&(0,L.jsx)(b.ZP,{className:"text-primary-500",destination:se.documentationLinks.learnMoreConfiguration,target:"_blank",rel:"noreferrer noopener",children:r.formatMessage(C["authoring.proctoring.learn.more"])});return(0,o.useEffect)((()=>{Promise.all([Z.Z.getProctoredExamSettingsData(ne),j.Z.isAvailable()?j.Z.getCourseExamConfiguration(ne):Promise.resolve(),j.Z.isAvailable()?j.Z.getAvailableProviders():Promise.resolve()]).then((e=>{let[r,t,o]=e;const i=r.data.proctored_exam_settings;h(!0),d(!1),X(!1),G(r.data.course_start_date);const n="proctortrack"===i.proctoring_provider;ee(n),z(r.data.available_proctoring_providers);const c=i.proctoring_escalation_email,l=r.data.available_proctoring_providers,g=o?.data||[],p=l.includes("lti_external");Y(p),U(g);let u,m=l.filter((e=>"lti_external"!==e));p&&(m=g.reduce(((e,r)=>[...e,r.name]),m)),z(m),u="lti_external"===i.proctoring_provider?t.data.provider:i.proctoring_provider,s(N(N({},a),{},{proctoringProvider:u,enableProctoredExams:i.enable_proctored_exams,allowOptingOut:i.allow_proctoring_opt_out,createZendeskTickets:i.create_zendesk_tickets,proctortrackEscalationEmail:null===c?"":c}))})).catch((e=>{403===e.response?.status?H(!0):I(!0),d(!1),h(!1),X(!1)}))}),[]),(0,o.useEffect)((()=>{(q||J)&&le.current&&le.current.focus(),!te.isValid&&ce.current&&ce.current.focus()}),[te,q,J]),(0,L.jsx)(k.Z,{title:"Proctoring Settings",isOpen:!0,onClose:t,size:"lg",variant:ie,hasCloseButton:ae,isFullscreenScroll:!0,isFullscreenOnMobile:!0,children:(0,L.jsxs)(v.ZP,{onSubmit:e=>{if(e.preventDefault(),"proctortrack"!==a.proctoringProvider||n.validate(a.proctortrackEscalationEmail)||""===a.proctortrackEscalationEmail&&!a.enableProctoredExams){!function(){const e=ue(a.proctoringProvider),r={proctored_exam_settings:{enable_proctored_exams:a.enableProctoredExams,proctoring_provider:e?"lti_external":a.proctoringProvider,create_zendesk_tickets:a.createZendeskTickets}};re&&(r.proctored_exam_settings.allow_proctoring_opt_out=a.allowOptingOut),"proctortrack"===a.proctoringProvider&&(r.proctored_exam_settings.proctoring_escalation_email=""===a.proctortrackEscalationEmail?null:a.proctortrackEscalationEmail),X(!0);const t=[Z.Z.saveProctoredExamSettingsData(ne,r)];F&&j.Z.isAvailable()&&t.push(j.Z.saveCourseExamConfiguration(ne,{provider:e?a.proctoringProvider:null})),Promise.all(t).then((()=>{W(!0),K(!1),X(!1)})).catch((()=>{W(!1),K(!0),X(!1)}))}();const e=N({},te.errors);delete e.formProctortrackEscalationEmail,oe({isValid:!0,errors:e})}else if(""===a.proctortrackEscalationEmail){const e=r.formatMessage(C["authoring.proctoring.escalationemail.error.blank"]);oe({isValid:!1,errors:{formProctortrackEscalationEmail:{dialogErrorMessage:(0,L.jsx)(f.Z.Link,{onClick:me,href:"#formProctortrackEscalationEmail","data-testid":"proctorTrackEscalationEmailErrorLink",children:e}),inputErrorMessage:e}}})}else{const e=r.formatMessage(C["authoring.proctoring.escalationemail.error.invalid"]);oe({isValid:!1,errors:{formProctortrackEscalationEmail:{dialogErrorMessage:(0,L.jsx)(f.Z.Link,{onClick:me,href:"#formProctortrackEscalationEmail","data-testid":"proctorTrackEscalationEmailErrorLink",children:e}),inputErrorMessage:e}}})}},"data-testid":"proctoringForm",children:[(0,L.jsx)(k.Z.Header,{children:(0,L.jsx)(k.Z.Title,{children:"Proctored Exam Settings"})}),(0,L.jsxs)(k.Z.Body,{children:[l?(0,L.jsx)(M.Z,{}):null,q?function(){const e=Z.Z.getStudioCourseRunUrl(ne);return(0,L.jsx)(f.Z,{variant:"success","data-testid":"saveSuccess",tabIndex:"-1",ref:le,onClose:()=>W(!1),dismissible:!0,children:(0,L.jsx)(u.Z,{id:"authoring.proctoring.alert.success",defaultMessage:"\n            Proctored exam settings saved successfully. {studioCourseRunURL}.\n          ",values:{studioCourseRunURL:(0,L.jsx)(f.Z.Link,{href:e,children:r.formatMessage(C["authoring.proctoring.studio.link.text"])})}})})}():null,J?(0,L.jsx)(f.Z,{variant:"danger","data-testid":"saveError",tabIndex:"-1",ref:le,onClose:()=>K(!1),dismissible:!0,children:(0,L.jsx)(u.Z,{id:"authoring.examsettings.alert.error",defaultMessage:"\n            We encountered a technical error while trying to save proctored exam settings.\n            This might be a temporary issue, so please try again in a few minutes.\n            If the problem persists, please go to the {support_link} for help.\n          ",values:{support_link:(0,L.jsx)(f.Z.Link,{href:(0,g.iE)().SUPPORT_URL,children:r.formatMessage(C["authoring.proctoring.support.text"])})}})}):null,m?(0,L.jsxs)(L.Fragment,{children:[!te.isValid&&te.errors.formProctortrackEscalationEmail&&(0,L.jsx)(f.Z,{id:"proctortrackEscalationEmailError",variant:"danger",tabIndex:"-1","data-testid":"proctortrackEscalationEmailError",ref:ce,children:function(){const e=Object.keys(te.errors).length,t=Object.entries(te.errors).map((e=>{let[r,t]=e;return(0,L.jsx)("li",{children:t.dialogErrorMessage},r)})),o=e>1?"authoring.proctoring.error.multiple":"authoring.proctoring.error.single";return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{children:r.formatMessage(C[o],{numOfErrors:e})}),(0,L.jsx)("ul",{children:t})]})}()}),(0,L.jsx)(y.Z,{id:"enable-proctoring-toggle",name:"enableProctoredExams",onChange:pe,checked:a.enableProctoredExams,label:(0,L.jsxs)("div",{className:"d-flex align-items-center",children:[r.formatMessage(C["authoring.proctoring.enableproctoredexams.label"]),a.enableProctoredExams&&(0,L.jsx)(x.Z,{className:"ml-2",variant:"success",children:r.formatMessage(C["authoring.proctoring.enabled"])})]}),helpText:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:r.formatMessage(C["authoring.proctoring.enableproctoredexams.help"])}),(0,L.jsx)("span",{className:"py-3",children:xe})]})}),a.enableProctoredExams&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("hr",{}),(0,L.jsxs)(v.ZP.Group,{controlId:"formProctoringProvider",children:[(0,L.jsx)(v.ZP.Label,{as:"legend",className:"font-weight-bold",children:r.formatMessage(C["authoring.proctoring.provider.label"])}),(0,L.jsx)(v.ZP.Control,{as:"select",name:"proctoringProvider",value:a.proctoringProvider,onChange:pe,"aria-describedby":"proctoringProviderHelpText",children:(ve=A,ve.map((e=>(0,L.jsx)("option",{value:e,disabled:fe(e),"data-testid":e,children:be(e)},e))))}),(0,L.jsx)(v.ZP.Text,{id:"proctoringProviderHelpText",children:he()?r.formatMessage(C["authoring.proctoring.provider.help.aftercoursestart"]):r.formatMessage(C["authoring.proctoring.provider.help"])})]})]}),$&&a.enableProctoredExams&&(0,L.jsxs)(v.ZP.Group,{controlId:"formProctortrackEscalationEmail",children:[(0,L.jsx)(v.ZP.Label,{className:"font-weight-bold",children:r.formatMessage(C["authoring.proctoring.escalationemail.label"])}),(0,L.jsx)(v.ZP.Control,{ref:de,type:"email",name:"proctortrackEscalationEmail","data-testid":"escalationEmail",onChange:pe,value:a.proctortrackEscalationEmail,isInvalid:Object.prototype.hasOwnProperty.call(te.errors,"formProctortrackEscalationEmail"),"aria-describedby":"proctortrackEscalationEmailHelpText"}),(0,L.jsx)(v.ZP.Text,{id:"proctortrackEscalationEmailHelpText",children:r.formatMessage(C["authoring.proctoring.escalationemail.help"])}),Object.prototype.hasOwnProperty.call(te.errors,"formProctortrackEscalationEmail")&&(0,L.jsx)(v.ZP.Control.Feedback,{type:"invalid",children:te.errors.formProctortrackEscalationEmail&&te.errors.formProctortrackEscalationEmail.inputErrorMessage})]}),re&&a.enableProctoredExams&&(0,L.jsx)("fieldset",{"aria-describedby":"allowOptingOutHelpText",children:(0,L.jsxs)(v.ZP.Group,{controlId:"formAllowingOptingOut",children:[(0,L.jsx)(v.ZP.Label,{as:"legend",className:"font-weight-bold",children:r.formatMessage(C["authoring.proctoring.allowoptout.label"])}),(0,L.jsxs)(v.ZP.RadioSet,{name:"allowOptingOut",value:a.allowOptingOut.toString(),onChange:pe,children:[(0,L.jsx)(v.ZP.Radio,{value:"true","data-testid":"allowOptingOutYes",children:r.formatMessage(C["authoring.proctoring.yes"])}),(0,L.jsx)(v.ZP.Radio,{value:"false","data-testid":"allowOptingOutNo",children:r.formatMessage(C["authoring.proctoring.no"])})]})]})}),re&&a.enableProctoredExams&&!ue(a.proctoringProvider)&&(0,L.jsx)("fieldset",{"aria-describedby":"createZendeskTicketsText",children:(0,L.jsxs)(v.ZP.Group,{controlId:"formCreateZendeskTickets",children:[(0,L.jsx)(v.ZP.Label,{as:"legend",className:"font-weight-bold",children:r.formatMessage(C["authoring.proctoring.createzendesk.label"])}),(0,L.jsxs)(v.ZP.RadioSet,{name:"createZendeskTickets",value:a.createZendeskTickets.toString(),onChange:pe,children:[(0,L.jsx)(v.ZP.Radio,{value:"true","data-testid":"createZendeskTicketsYes",children:r.formatMessage(C["authoring.proctoring.yes"])}),(0,L.jsx)(v.ZP.Radio,{value:"false","data-testid":"createZendeskTicketsNo",children:r.formatMessage(C["authoring.proctoring.no"])})]})]})})]}):null,R?(0,L.jsx)(_.Z,{}):null,D?(0,L.jsx)(w.Z,{}):null]}),(0,L.jsx)(k.Z.Footer,{className:i()("p-4"),children:(0,L.jsxs)(E.Z,{children:[(0,L.jsx)(k.Z.CloseButton,{variant:"tertiary",children:r.formatMessage(C["authoring.proctoring.cancel"])}),(0,L.jsx)(P.Z,{labels:{default:r.formatMessage(C["authoring.proctoring.save"]),pending:r.formatMessage(C["authoring.proctoring.saving"])},description:"Form save button","data-testid":"submissionButton",disabled:Q,state:ge,type:"submit"})]})})]})});var ve};D.propTypes={intl:m.gm.isRequired,onClose:d().func.isRequired},D.defaultProps={};const H=(0,h.Z)(D)}}]);
//# sourceMappingURL=681.ff30e3ee85e12444de67.js.map